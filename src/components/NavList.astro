---
import { ChevronDown } from "lucide-astro";

import type { TreeNode } from "../types";

interface Props {
	tree: Record<string, TreeNode>;
}

const { tree } = Astro.props;

const pathname = Astro.url.pathname;
const formattedPathname = pathname !== "/" ? pathname.replace(/\/$/, "") : "/";
---

<ul>
	{
		Object.entries(tree).map(([title, node]) => {
			const { path, children, level } = node;
			const isCollapsible = Object.keys(children).length > 0;
			const isSelected = path === formattedPathname;
			const id = `list-item-${path.replace(/\//g, "-")}`;
			return (
				<li
					id={id}
					data-collapsed="false"
					class="group group-data-[collapsed=true]:hidden"
				>
					<a
						href={path}
						class="text-sm font-mono group flex items-center border-l text-white border-blue data-[selected=true]:border-white data-[selected=true]:bg-white/20 hover:bg-white/20"
						data-collapsible={String(isCollapsible)}
						data-selected={String(isSelected)}
					>
						{Array.from({ length: level }).map(() => (
							<span class="ml-3 self-stretch border-l border-white" />
						))}
						{isCollapsible ? (
							<span class="ml-1 flex items-center">
								<span class="relative">
									<ChevronDown
										size="17px"
										stroke-width="1.5px"
										class="-mb-0.5 group-data-[collapsed=true]:-rotate-90"
									/>
									<div class="group-data-[collapsed=true]:hidden absolute w-[1px] h-[8px] left-1/2 -translate-x-1/2 bottom-[-3px] bg-white" />
								</span>

								<span class="ml-1">{title}</span>
							</span>
						) : (
							<span class="ml-3">{title}</span>
						)}
					</a>
					{isCollapsible && <Astro.self tree={children} />}
				</li>
			);
		})
	}
</ul>
